# -*- encoding=utf8 -*-
__author__ = "han'yuan'lin"

from airtest.core.api import *

auto_setup(__file__)


from poco.drivers.android.uiautomation import AndroidUiautomationPoco
poco = AndroidUiautomationPoco(use_airtest_input=True, screenshot_each_action=False)
poco('com.starmakerinteractive.starmaker:id/tab_name',text="动态" ).click()
sleep(1.0)
if exists(Template(r"tpl1684376458096.png", record_pos=(-0.003, -0.016), resolution=(1080, 2400))):
    touch([918, 565])
poco('com.starmakerinteractive.starmaker:id/tv_tab_title').click()
sleep(1.0)
if exists(Template(r"tpl1684295707075.png", record_pos=(0.003, -0.014), resolution=(1080, 2400))):
    touch(Template(r"tpl1684295733951.png", record_pos=(-0.188, 0.247), resolution=(1080, 2400)))
if exists(Template(r"tpl1684808755818.png", record_pos=(0.005, -0.83), resolution=(1080, 2400))):
    touch(Template(r"tpl1684808761541.png", record_pos=(0.33, -0.827), resolution=(1080, 2400)))
sleep(1.0)    
if exists(Template(r"tpl1684206111024.png", record_pos=(0.003, -0.022), resolution=(1080, 2400))):
    touch(Template(r"tpl1684206214681.png", record_pos=(-0.004, 0.239), resolution=(1080, 2400)))
assert_exists(Template(r"tpl1684304978835.png", record_pos=(-0.108, -0.736), resolution=(1080, 2400)), "success")
keyevent("keycode_back")
sleep(2.0)
touch([88, 444])
sleep(3.0)
poco('com.starmakerinteractive.starmaker:id/iv_share').click()
sleep(0.5)
poco('com.starmakerinteractive.starmaker:id/et_search').click()
text("1", search=True)
sleep(2.0)
if exists(Template(r"tpl1684314260590.png", record_pos=(0.027, 0.149), resolution=(1080, 2400))):
    keyevent("KEYCODE_DEL"),text("a", search=True)
sleep(1.5)
if not exists(Template(r"tpl1684377739439.png", record_pos=(0.027, 0.127), resolution=(1080, 2400))):
    touch([1004, 474])
sleep(1.0)
poco('com.starmakerinteractive.starmaker:id/btn_share').click()
assert_exists(Template(r"tpl1684377290997.png", record_pos=(-0.019, 0.783), resolution=(1080, 2400)), "success")
sleep(1.5)
if exists(Template(r"tpl1684382637991.png", record_pos=(0.005, -0.487), resolution=(1080, 2400))):
    touch([129, 805])
sleep(1.0)    
if exists(Template(r"tpl1684381839505.png", record_pos=(-0.094, 0.815), resolution=(1080, 2400))):
    keyevent("keycode_back")
sleep(2.0)
touch(Template(r"tpl1684382715505.png", record_pos=(-0.056, -0.594), resolution=(1080, 2400)))
sleep(1.5)
poco('com.starmakerinteractive.starmaker:id/btn_action')[1].click()
if exists(Template(r"tpl1684317097375.png", record_pos=(-0.013, -0.399), resolution=(1080, 2400))):
    touch(Template(r"tpl1684317107220.png", record_pos=(-0.009, -0.137), resolution=(1080, 2400)))
if not exists(Template(r"tpl1684309929820.png", record_pos=(0.018, 0.846), resolution=(1080, 2400))):
    touch(Template(r"tpl1684317076779.png", record_pos=(0.38, -0.678), resolution=(1080, 2400)))
if exists(Template(r"tpl1684317097375.png", record_pos=(-0.013, -0.399), resolution=(1080, 2400))):
    touch(Template(r"tpl1684317107220.png", record_pos=(-0.009, -0.137), resolution=(1080, 2400)))
if exists(Template(r"tpl1684376847417.png", record_pos=(0.011, 0.918), resolution=(1080, 2400))):
    keyevent("keycode_back")
sleep(1.5)
touch([71, 132])
assert_exists(Template(r"tpl1684381542210.png", record_pos=(-0.004, 0.896), resolution=(1080, 2400)), "success")
poco('com.starmakerinteractive.starmaker:id/fab' ).click()
sleep(1.0)
if exists(Template(r"tpl1684379961855.png", record_pos=(-0.164, 0.925), resolution=(1080, 2400))):
    keyevent("keycode_back")
assert_exists(Template(r"tpl1684380018921.png", record_pos=(-0.001, 0.901), resolution=(1080, 2400)), "success")
sleep(1.0)
keyevent("keycode_back")
swipe([537, 1969],[551, 449])
poco('com.starmakerinteractive.starmaker:id/btn_say').click()
if exists(Template(r"tpl1684380227279.png", record_pos=(0.009, 0.146), resolution=(1080, 2400))):
    touch([532, 1476])
poco('com.starmakerinteractive.starmaker:id/send_button' ).click()
sleep(1.0)
poco('com.starmakerinteractive.starmaker:id/message_edit' ).click()
text("这是一个断言",enter = False)
poco('com.starmakerinteractive.starmaker:id/send_button' ).click()
assert_exists(Template(r"tpl1684380929990.png", record_pos=(0.238, -0.224), resolution=(1080, 2400)), "success")
sleep(1.0)
touch(Template(r"tpl1684392098446.png", record_pos=(0.425, -0.559), resolution=(1080, 2400)))
sleep(2.0)
touch([68, 148])
assert_exists(Template(r"tpl1684381129364.png", record_pos=(-0.181, -0.978), resolution=(1080, 2400)), "success")
#发布器recording进入录制
poco('com.starmakerinteractive.starmaker:id/tab_name',text="动态" ).click()
sleep(1.0)
poco('com.starmakerinteractive.starmaker:id/publish_icon').click()
sleep(1.0)
if exists(Template(r"tpl1684206111024.png", record_pos=(0.003, -0.022), resolution=(1080, 2400))):
    touch(Template(r"tpl1684206214681.png", record_pos=(-0.004, 0.239), resolution=(1080, 2400)))
poco('com.starmakerinteractive.starmaker:id/tv_add' ).click()
if exists(Template(r"tpl1684206880847.png", record_pos=(-0.035, 0.621), resolution=(1080, 2400))):
    touch(Template(r"tpl1684206889636.png", record_pos=(0.006, 0.6), resolution=(1080, 2400)))
poco('com.starmakerinteractive.starmaker:id/recording_headset_dialog_i_know_btn' ).click()
sleep(5.0)
poco('com.starmakerinteractive.starmaker:id/rbtn_record_recorder_song_fragment_song_record' ).click()
sleep(3.0)
swipe([518, 1658],[532, 747])
sleep(10.0)
poco('com.starmakerinteractive.starmaker:id/iv_done_recorder_song_fragment_song_record').click()
if exists(Template(r"tpl1684224574053.png", record_pos=(-0.001, -0.019), resolution=(1080, 2400))):
    touch(Template(r"tpl1684224590847.png", record_pos=(0.202, 0.113), resolution=(1080, 2400)))
sleep(10.0)
touch([612, 1313])
sleep(3.0)
swipe([510, 1867],[543, 720])
poco('com.starmakerinteractive.starmaker:id/ret_input_baserecord_fragment_editor').click()
text("love")
poco('com.starmakerinteractive.starmaker:id/v_place').click()
poco('com.starmakerinteractive.starmaker:id/ll_duet_baserecord_fragment_edit' ).click()
sleep(0.5)
poco('com.starmakerinteractive.starmaker:id/choice_no_allow_duet_check').click()
sleep(0.5)
poco('com.starmakerinteractive.starmaker:id/choice_ok' ).click()
sleep(0.5)
poco('com.starmakerinteractive.starmaker:id/tv_next_baserecord_fragment_edit_btn').click()
poco('com.starmakerinteractive.starmaker:id/iv_close'  ).click()
assert_exists(Template(r"tpl1684227286327.png", record_pos=(-0.24, -0.373), resolution=(1080, 2400)), "success")
#发布器搜索伴奏后录制发布
poco('com.starmakerinteractive.starmaker:id/tab_name',text="动态" ).click()
sleep(1.0)
poco('com.starmakerinteractive.starmaker:id/publish_icon').click()
sleep(1.0)
if exists(Template(r"tpl1681956281440.png", record_pos=(0.003, -0.015), resolution=(720, 1600))):
    touch(Template(r"tpl1681956343304.png", record_pos=(-0.017, 0.253), resolution=(720, 1600)))
poco('com.starmakerinteractive.starmaker:id/txt_search').click()
sleep(1)
poco('com.starmakerinteractive.starmaker:id/searchView').click()
text("love", search=True)
sleep(1)
poco('com.starmakerinteractive.starmaker:id/lyt_sing' ).click()
if exists(Template(r"tpl1684206880847.png", record_pos=(-0.035, 0.621), resolution=(1080, 2400))):
    touch(Template(r"tpl1684206889636.png", record_pos=(0.006, 0.6), resolution=(1080, 2400)))
poco('com.starmakerinteractive.starmaker:id/recording_headset_dialog_i_know_btn' ).click()
sleep(5.0)
poco('com.starmakerinteractive.starmaker:id/rbtn_record_recorder_song_fragment_song_record' ).click()
sleep(3.0)
swipe([518, 1658],[532, 747])
sleep(10.0)
poco('com.starmakerinteractive.starmaker:id/iv_done_recorder_song_fragment_song_record').click()
if exists(Template(r"tpl1684224574053.png", record_pos=(-0.001, -0.019), resolution=(1080, 2400))):
    touch(Template(r"tpl1684224590847.png", record_pos=(0.202, 0.113), resolution=(1080, 2400)))
sleep(10.0)
touch([612, 1313])
sleep(3.0)
swipe([510, 1867],[543, 720])
poco('com.starmakerinteractive.starmaker:id/ret_input_baserecord_fragment_editor').click()
text("love")
poco('com.starmakerinteractive.starmaker:id/v_place' ).click()
poco('com.starmakerinteractive.starmaker:id/ll_duet_baserecord_fragment_edit' ).click()
sleep(0.5)
poco('com.starmakerinteractive.starmaker:id/choice_no_allow_duet_check').click()
sleep(0.5)
poco('com.starmakerinteractive.starmaker:id/choice_ok' ).click()
sleep(0.5)
poco('com.starmakerinteractive.starmaker:id/tv_next_baserecord_fragment_edit_btn').click()
poco('com.starmakerinteractive.starmaker:id/iv_close'  ).click()
assert_exists(Template(r"tpl1684227286327.png", record_pos=(-0.24, -0.373), resolution=(1080, 2400)), "success")
#发布器图文发布
poco('com.starmakerinteractive.starmaker:id/tab_name',text="动态" ).click()
sleep(1.0)
poco('com.starmakerinteractive.starmaker:id/publish_icon').click()
sleep(1.0)
if exists(Template(r"tpl1681956281440.png", record_pos=(0.003, -0.015), resolution=(720, 1600))):
    touch(Template(r"tpl1681956343304.png", record_pos=(-0.017, 0.253), resolution=(720, 1600)))
sleep(2.0)   
touch([217, 2204])
sleep(1.0)
if exists(Template(r"tpl1684227563818.png", record_pos=(0.003, 0.641), resolution=(1080, 2400))):
    touch(Template(r"tpl1684227573141.png", record_pos=(-0.016, 0.716), resolution=(1080, 2400)))
sleep(2.0)    
touch([300, 375]),touch([659, 377])
sleep(1.0)
poco('com.starmakerinteractive.starmaker:id/tv_topic' ).click()
sleep(1.0)
poco('com.starmakerinteractive.starmaker:id/btn_next').click()
sleep(2.0)
poco('com.starmakerinteractive.starmaker:id/ret_post_desc' ).click()
text("love")
poco('com.starmakerinteractive.starmaker:id/tv_done').click()
sleep(2.0)
poco('com.starmakerinteractive.starmaker:id/tv_post').click()
assert_exists(Template(r"tpl1684227286327.png", record_pos=(-0.24, -0.373), resolution=(1080, 2400)), "success")
#发布器小视频发布
poco('com.starmakerinteractive.starmaker:id/tab_name',text="动态" ).click()
sleep(1.0)
poco('com.starmakerinteractive.starmaker:id/publish_icon').click()
if exists(Template(r"tpl1681956281440.png", record_pos=(0.003, -0.015), resolution=(720, 1600))):
    touch(Template(r"tpl1681956343304.png", record_pos=(-0.017, 0.253), resolution=(720, 1600)))
sleep(1.0)
touch([386, 2207])
if exists(Template(r"tpl1684231637398.png", record_pos=(-0.001, -0.244), resolution=(1080, 2400))):
    touch(Template(r"tpl1684231651478.png", record_pos=(0.001, 0.232), resolution=(1080, 2400)))
poco('com.android.permissioncontroller:id/permission_allow_foreground_only_button').click()
sleep(1.0)
touch([551, 1939],duration=10)
sleep(3.0)
poco('com.starmakerinteractive.starmaker:id/ret_post_desc' ).click()
text("love")
poco('com.starmakerinteractive.starmaker:id/tv_done').click()
sleep(2.0)
touch([560, 2179])
assert_exists(Template(r"tpl1684227286327.png", record_pos=(-0.24, -0.373), resolution=(1080, 2400)), "success")